<% @aggregated_notifications.each do | work_package, notifications_by_work_package| %>

  <%= "=" * (('# ' + work_package.id.to_s + work_package.subject).length + 4) %>
  = #<%= work_package.id %> <%= work_package.subject %> =
  <%= "=" * (('# ' + work_package.id.to_s + work_package.subject).length + 4) %>

  <% notifications_by_work_package.each do | notification | %>
    <%= "-" * 20 %>

    <%= digest_notification_timestamp_text(
          notification,
          html: false,
          extended_text: true) %> (<%= I18n.t('mail.digests.work_packages.reason.prefix',
                                              reason: I18n.t(:"mail.digests.work_packages.reason.#{notification.reason_mail_digest}")) %>)

    <% journal = notification.journal %>
    <% if journal.notes.present? %>
      <%= journal.notes %>

    <% end %>
    <% journal.details.each do |detail| %>
      * <%= journal.render_detail(detail, only_path: false, no_html: true) %>
    <% end %>

    <%= "-" * 20 %>
  <% end %>
<% end %>
